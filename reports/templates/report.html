<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ ip_name }} - Vyges IP Report</title>
    <link rel="stylesheet" href="report.css">
    <link rel="icon" type="image/x-icon" href="https://vyges.com/assets/images/favicon.ico">
</head>
<body>
    <!-- Header with Branding -->
    <header class="report-header">
        <div class="header-content">
            <div class="logo-section">
                <img id="repo-logo" src="https://vyges.com/default-repo-logo.png" alt="Repository Logo" class="repo-logo" onerror="this.src='https://vyges.com/default-repo-logo.png'">
                <div class="vyges-branding">
                    <img src="https://vyges.com/assets/images/logo.svg" alt="Vyges" class="vyges-logo">
                    <span class="generated-by">Auto-generated by Vyges</span>
                </div>
            </div>
            <div class="ip-info">
                <h1 class="ip-name">{{ ip_name }}</h1>
                <div class="ip-meta">
                    <span class="version">v{{ ip_version }}</span>
                    <span class="last-updated">Last updated: {{ timestamp }}</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Summary Cards -->
    <section class="summary-cards">
        <div class="card">
            <div class="card-content">
                <p class="card-value" id="overall-score-value">{{ overall_score | default('TBD') }}</p>
                <h3>Overall Score</h3>
            </div>
        </div>
        <div class="card">
            <div class="card-content">
                <p class="card-value" id="gates-value">{{ gates | default('TBD') }}</p>
                <h3>Gates</h3>
            </div>
        </div>
        <div class="card">
            <div class="card-content">
                <p class="card-value" id="die-size-value">{{ die_size | default('TBD') }}</p>
                <h3>Die Size</h3>
            </div>
        </div>
        <div class="card">
            <div class="card-content">
                <p class="card-value" id="rtl-lines-value">{{ rtl_lines | default('TBD') }}</p>
                <h3>RTL Lines</h3>
            </div>
        </div>
        <div class="card">
            <div class="card-content">
                <p class="card-value" id="test-files-value">{{ test_files | default('TBD') }}</p>
                <h3>Test Files</h3>
            </div>
        </div>
        <div class="card">
            <div class="card-content">
                <p class="card-value" id="target-value">{{ target | default('TBD') }}</p>
                <h3>Target</h3>
            </div>
        </div>
        <div class="card">
            <div class="card-content">
                <p class="card-value" id="design-type-value">{{ design_type | default('TBD') }}</p>
                <h3>Design Type</h3>
            </div>
        </div>
    </section>

    <!-- Report Listing Table -->
    <section class="reports-section">
        <h2>Available Reports</h2>
        <div class="reports-table">
            <table class="reports-table-content">
                <thead>
                    <tr>
                        <th>Report Name</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Test Harness Report</strong></td>
                        <td>Comprehensive test results, simulation analysis, and verification coverage for the IP implementation.</td>
                        <td>
                            <a href="./test_harness_report.html" target="_blank" class="report-link html">HTML</a>
                            <a href="./test_harness_report.md" target="_blank" class="report-link md">Markdown</a>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Code KPIs Report</strong></td>
                        <td>Code quality metrics, project analysis, and Vyges metadata compliance assessment.</td>
                        <td>
                            <a href="./code_kpis.txt" target="_blank" class="report-link txt">Text</a>
                            <a href="./code_kpis.json" target="_blank" class="report-link json">JSON</a>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Waveform Analysis</strong></td>
                        <td>VCD waveform analysis for debugging and signal analysis.</td>
                        <td>
                            <a href="./waveforms/index.html" target="_blank" class="report-link html">ðŸŒŠ Waveforms</a>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Test Coverage Report</strong></td>
                        <td>Comprehensive test coverage analysis and verification results.</td>
                        <td>
                            <a href="./coverage_summary.txt" target="_blank" class="report-link txt">Text</a>
                            <a href="./coverage/" target="_blank" class="report-link html">ðŸ“Š Coverage</a>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Synthesis Results</strong></td>
                        <td>ASIC and FPGA synthesis reports, resource utilization, and timing analysis.</td>
                        <td>
                            <a href="./synthesis_report.html" target="_blank" class="report-link html">HTML</a>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Gate Analysis Report</strong></td>
                        <td>Detailed gate-level analysis showing primitive gate counts, transistor estimates, and design complexity metrics.</td>
                        <td>
                            <a href="./gate_analysis_report.html" target="_blank" class="report-link html">HTML</a>
                            <a href="./gate_analysis_report.md" target="_blank" class="report-link md">Markdown</a>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>FPGA Implementation</strong></td>
                        <td>Open-source FPGA flow results for various FPGA families.</td>
                        <td>
                            <a href="./fpga_flow_summary.md" target="_blank" class="report-link md">Markdown</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- Test Results Summary -->
    <section class="test-summary-section">
        <h2>Test Results Summary</h2>
        <div class="test-summary">
            <div class="test-stats">
                <div class="stat-item">
                    <span class="stat-value">{{ tests | length }}</span>
                    <span class="stat-label">Total Tests</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">{{ tests | selectattr('status', 'equalto', 'pass') | list | length }}</span>
                    <span class="stat-label">Passed</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">{{ tests | selectattr('status', 'equalto', 'fail') | list | length }}</span>
                    <span class="stat-label">Failed</span>
                </div>
            </div>
        </div>
    </section>



    <!-- Footer -->
    <footer class="report-footer">
        <div class="footer-content">
            <p>This report was automatically generated by <a href="https://vyges.com" target="_blank">Vyges</a> on {{ timestamp }}</p>
            <p>For questions about this report or the IP, please refer to the repository or contact Vyges support.</p>
        </div>
    </footer>

    <!-- JavaScript for dynamic data fetching -->
    <script>
        // Configuration
        const config = {
            repoUrl: '{{ repo_url }}',
            ipName: '{{ ip_name }}',
            enableGitHubFetch: true
        };

        // Extract GitHub owner and repo from URL
        function extractGitHubInfo(url) {
            if (!url || !url.includes('github.com')) return null;
            
            const match = url.match(/github\.com\/([^\/]+)\/([^\/]+)/);
            if (match) {
                return {
                    owner: match[1],
                    repo: match[2]
                };
            }
            return null;
        }

        // Fetch GitHub repository information
        async function fetchGitHubInfo() {
            if (!config.enableGitHubFetch) return;
            
            const githubInfo = extractGitHubInfo(config.repoUrl);
            if (!githubInfo) return;

            try {
                // Note: This would require a GitHub token for authenticated requests
                // For now, we'll use the public API which has rate limits
                const response = await fetch(`https://api.github.com/repos/${githubInfo.owner}/${githubInfo.repo}`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Update repo logo
                    const repoLogo = document.getElementById('repo-logo');
                    if (repoLogo && data.owner && data.owner.avatar_url) {
                        repoLogo.src = data.owner.avatar_url;
                        repoLogo.alt = `${data.owner.login} Avatar`;
                    }
                    
                    // Update additional metadata if available
                    updateGitHubMetadata(data);
                }
            } catch (error) {
                console.log('GitHub API fetch failed (this is normal for public repos):', error.message);
                // Fallback to default logo
                const repoLogo = document.getElementById('repo-logo');
                if (repoLogo) {
                    repoLogo.src = 'https://vyges.com/default-repo-logo.png';
                }
            }
        }

        // Update GitHub metadata in the report
        function updateGitHubMetadata(data) {
            // Add repository description if available
            if (data.description) {
                const description = document.querySelector('.description');
                if (description && !description.textContent.trim()) {
                    description.textContent = data.description;
                }
            }
            
            // Add repository stats if available
            if (data.stargazers_count !== undefined) {
                addRepositoryStats(data);
            }
        }

        // Add repository statistics
        function addRepositoryStats(data) {
            const headerContent = document.querySelector('.header-content');
            if (!headerContent) return;
            
            // Check if stats already exist
            if (document.getElementById('repo-stats')) return;
            
            const statsDiv = document.createElement('div');
            statsDiv.id = 'repo-stats';
            statsDiv.className = 'repo-stats';
            statsDiv.innerHTML = `
                <div class="stat-item">
                    <span class="stat-value">${data.stargazers_count || 0}</span>
                    <span class="stat-label">Stars</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${data.forks_count || 0}</span>
                    <span class="stat-label">Forks</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${data.open_issues_count || 0}</span>
                    <span class="stat-label">Issues</span>
                </div>
            `;
            
            headerContent.appendChild(statsDiv);
        }

        // Initialize the report
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Vyges IP Report initialized');
            
            // Fetch GitHub information
            fetchGitHubInfo();
            
            // Add loading states for missing data
            addLoadingStates();
            
            // Enhance the report with additional features
            enhanceReport();
        });

        // Add loading states for missing data
        function addLoadingStates() {
            // Check for empty sections and add placeholders
            const sections = [
                { id: 'key-differentiators-list', fallback: 'High-performance design, Comprehensive verification, Multiple target support' },
                { id: 'configurations-list', fallback: 'Configurable bit-widths, Multiple interface options, Customizable parameters' },
                { id: 'interfaces-list', fallback: 'Standard interfaces will be populated from RTL analysis' },
                { id: 'parameters-list', fallback: 'Parameters will be extracted from RTL modules' }
            ];
            
            sections.forEach(section => {
                const element = document.getElementById(section.id);
                if (element && element.children.length === 0) {
                    element.innerHTML = `<li>${section.fallback}</li>`;
                }
            });
        }

        // Enhance the report with additional features
        function enhanceReport() {
            // Add copy functionality for code blocks
            addCopyButtons();
            
                    // Add print styles
        addPrintStyles();
        }

        // Add copy buttons to code blocks
        function addCopyButtons() {
            const codeBlocks = document.querySelectorAll('code');
            codeBlocks.forEach(code => {
                const button = document.createElement('button');
                button.className = 'copy-button';
                button.textContent = 'Copy';
                button.onclick = () => {
                    navigator.clipboard.writeText(code.textContent);
                    button.textContent = 'Copied!';
                    setTimeout(() => button.textContent = 'Copy', 2000);
                };
                code.parentNode.insertBefore(button, code.nextSibling);
            });
        }

        // Add print styles
        function addPrintStyles() {
            const style = document.createElement('style');
            style.textContent = `
                @media print {
                    .copy-button { display: none !important; }
                    .report-header { background: white !important; color: black !important; }
                    .card { break-inside: avoid; }
                    section { break-inside: avoid; }
                }
            `;
            document.head.appendChild(style);
        }
    </script>
</body>
</html>
